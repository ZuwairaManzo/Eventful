import React, { useState, useEffect } from 'react';
import Header from '../components/Header';
import Footer from '../components/Footer';
import EventList from '../components/EventList';
import QRCodeViewer from '../components/QRCodeViewer';
import eventService from '../services/eventService';
import qrcodeService from '../services/qrcodeService';

const Dashboard = () => {
  const [events, setEvents] = useState([]);
  const [qrCode, setQrCode] = useState(null);

  useEffect(() => {
    const fetchEvents = async () => {
      try {
        const events = await eventService.getRegisteredEvents();
        setEvents(events);
      } catch (error) {
        console.error(error);
      }
    };
    fetchEvents();
  }, []);

  const handleRegisterEvent = async (eventId) => {
    try {
      const ticket = await eventService.registerForEvent(eventId);
      const qrCode = await qrcodeService.generateQRCode(ticket.id);
      setQrCode(qrCode);
    } catch (error) {
      console.error(error);
    }
  };

  return (
    <div>
      <Header />
      <main>
        <h1>Dashboard</h1>
        <EventList events={events} onRegisterEvent={handleRegisterEvent} />
        {qrCode && <QRCodeViewer qrCode={qrCode} />}
      </main>
      <Footer />
    </div>
  );
};

export default Dashboard;